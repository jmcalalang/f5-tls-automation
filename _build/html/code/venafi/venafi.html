<!DOCTYPE html>
<div id="clouddocs-header">
  <div class="container-fluid">
    <div class="row corp-header">
      <div class="container corp-header">
        <div class="container corp-menu">
          <ul>
            <li><a href="https://f5.com" class="internalLink">F5.com</a></li>
            <li><a href="https://github.com/F5Networks" class="externalLink">GitHub</a></li>
            <li><a href="https://devcentral.f5.com" class="internalLink">Devcentral</a></li>
            <li><a href="https://support.f5.com" class="internalLink">Support</a></li>
          </ul>
        </div>
      </div>
    </div>

    <script async="async"
      src="https://consent.trustarc.com/notice?domain=f5.com&amp;c=teconsent&amp;text=true&amp;gtm=1" crossorigin=""
      id="truste_0.12182038258598205"></script>

    <div class="row pageHeader">
      <div class="container stat">
        <div class="col-xs-12 stat">
          <a class="internalLink" href="https://f5.com">
            <img class="logo" src="https://cdn.f5.com/websites/support/assets/images/logo.svg" width="50" height="44"
              alt="F5 Networks" title="F5 Networks" border="0">
          </a>
          <ul id="MainMenu" class="main-menu">
            <li data-submenu-id="products">
              <a data-link-type="nav: main" href="#" class="currentURL">Products
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="products-submenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h">BIG-IP Extensibility</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-extension/latest" data-link-type="Nav: Mega">F5
                            Application Services Extension 3</a></li>
                        <li><a href="https://clouddocs.f5.com/products/agc/latest" data-link-type="Nav: Mega">BIG-IP APM Access Guided
                            Configuration</a></li>
                        <li><a href="https://clouddocs.f5.com/products/iapp/iapp-lx/latest" data-link-type="Nav: Mega">iApps LX/iControl LX</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-declarative-onboarding/latest"
                            data-link-type="Nav: Mega">F5 Declarative Onboarding</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-telemetry-streaming/latest" data-link-type="Nav: Mega">F5
                            Telemetry Streaming</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-cloud-failover/latest" data-link-type="Nav: Mega">F5 Cloud
                            Failover</a></li>
                        <li><a href="https://clouddocs.f5.com/products/extensions/f5-appsvcs-templates/latest/" data-link-type="Nav: Mega">F5
                            Application Services Templates</a></li>
                      </ul>
                    </li>


                    <li class="divider"></li>
                    <li><span class="a-mm-h">Container Ingress Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/" data-link-type="Nav: Mega">F5 BIG-IP Controller for
                            Kubernetes/OpenShift</a></li>
                      </ul>
                      <span class="a-mm-h">Network Function Virtualization</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/nfv/latest" data-link-type="Nav: Mega">F5 VNF Manager</a></li>
                      </ul>
                      <span class="a-mm-h">SDK</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-cli" target="_blank">F5 CLI</a></li>
                        <li><a href="https://clouddocs.f5.com/sdk/f5-sdk-python" target="_blank">F5 SDK Python</a></li>
                      </ul>
                    </li>



                    <li class="divider"></li>
                    <li>
                      <span class="a-mm-h">OpenStack</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/openstack/agent/latest" data-link-type="Nav: Mega">F5 Agent - OpenStack
                            Neutron</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/lbaasv2-driver/latest" data-link-type="Nav: Mega">F5 Driver -
                            OpenStack LBaaS</a></li>
                        <li><a href="https://clouddocs.f5.com/products/openstack/heat-plugins/latest" data-link-type="Nav: Mega">F5 Plugins -
                            OpenStack Heat</a></li>
                      </ul>

                      <span class="a-mm-h">Ecosystems Integrations</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/f5-aci-servicecenter/latest" data-link-type="Nav: Mega">F5 ACI ServiceCenter</a>
                        </li>
                      </ul>


                    </li>
                    <li class="divider"></li>
                    <li><span class="a-mm-h">Orchestration</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/ansible/devel" target="_blank">F5 Modules for Ansible</a>
                        </li>
                        <li><a href="https://github.com/F5Networks/f5-aws-cloudformation" target="_blank"
                            class="externalLink">F5 Templates for AWS CloudFormation</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-azure-arm-templates" target="_blank"
                            class="externalLink">F5 Templates for Azure ARM</a> (GitHub)</li>
                        <li><a href="https://github.com/F5Networks/f5-google-gdm-templates" target="_blank"
                            class="externalLink">F5 Templates for Google Cloud Deployment Manager</a> (GitHub)</li>
                        <li><a href="https://clouddocs.f5.com/products/templates/openstack-heat/latest" data-link-type="Nav: Mega">F5 Templates
                            for OpenStack Heat</a></li>
                        <li><a href="https://clouddocs.f5.com/products/orchestration/terraform/latest/" data-link-type="Nav: Mega">F5 Resources
                            for Terraform Provider</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>

            <!--- NEW -->
            <li>
              <a href="#" class="currentURL">APIs
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="APISubmenu">
                <div class="container">
                  <ul class="submenu">
                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/products/big-iq/mgmt-api/latest/" data-link-type="Nav: Mega">F5 BIG-IQ API</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/api/iapps/">F5 BIG-IP iApps</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules">F5 BIG-IP iRules API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/irules-lx">F5 BIG-IP iRulesLX API</a></li>
                      </ul>
                    </li>

                    <li class="divider"></li>

                    <li>
                      <span class="a-mm-h"></span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-rest">F5 BIG-IP iControlREST API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/icontrol-soap/">F5 BIG-IP iControl API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/ihealth/">F5 iHealth API</a></li>
                        <li><a href="https://clouddocs.f5.com/api/tmsh">F5 tmsh scripting API</a></li>
                      </ul>
                    </li>

                  </ul>
                </div>
              </div>
            </li>




            <li>
              <a href="#" class="currentURL">Cloud &amp; Container
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>

              <div class="menu-panel soft-hide" id="ContainersSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third"><span class="a-mm-h">Cloud Services</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GS-About.html"
                            data-link-type="Nav: Mega">Get Started</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Beacon-About.html"
                            data-link-type="Nav: Mega">Beacon</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-DNS-About.html"
                            data-link-type="Nav: Mega">DNS Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-GSLB-About.html"
                            data-link-type="Nav: Mega">DNS Load Balancer Cloud Service</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud-services/latest/f5-cloud-services-Essential.App.Protect-About.html"
                            data-link-type="Nav: Mega">Essential App Protect Service</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Clouds</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/aws_index.html" data-link-type="Nav: Mega">AWS</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/azure_index.html" data-link-type="Nav: Mega">Azure</a></li>
                        <li><a href="https://clouddocs.f5.com/cloud/public/v1/google_index.html" data-link-type="Nav: Mega">Google Cloud</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/cloud/openstack/" data-link-type="Nav: Mega">OpenStack</a></li>
                      </ul>
                      <!-- unnecessary right now>
                    <span class="seemore"><a data-link-type="Nav: Mega" href="/cloud/">See all </a></span>
                    <-->
                    </li>
                    <li class="divider"></li>
                    <li class="third"><span class="a-mm-h">Containers</span>
                      <ul>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/kubernetes/" data-link-type="Nav: Mega">Kubernetes</a>
                        </li>
                        <li><a href="https://clouddocs.f5.com/containers/latest/userguide/openshift/" data-link-type="Nav: Mega">OpenShift</a>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
            <li>
              <a href="#" class="currentURL">Resources
                <span class="indicator"><span class="arrow-up"></span></span>
              </a>
              <div class="menu-panel soft-hide" id="UPCProgramSubmenu">
                <div class="container">
                  <ul class="submenu col-sm-11">
                    <li class="third">
                      <span class="a-mm-h">Downloads</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://hub.docker.com/r/f5networks/"
                            class="internalLink externalLink">Docker Hub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega"
                            href="https://store.docker.com/images/f5networks-asp"
                            class="internalLink externalLink">Docker Store</a></li>
                      </ul>
                      <span class="a-mm-h">OpenSource</span>
                      <ul>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5Networks"
                            class="internalLink externalLink">F5Networks on GitHub</a></li>
                        <li><a target="_blank" data-link-type="Nav: Mega" href="https://github.com/F5DevCentral"
                            class="internalLink externalLink">F5DevCentral on GitHub</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>
                    <li class="third">
                      <span class="a-mm-h">Training &amp; Labs</span>
                      <ul>
                        <li>
                          <p>Learn how to get the most out of the F5 platform</p>
                        </li>
                        <li><a href="https://clouddocs.f5.com/training/community">Community</a></li>
                      </ul>
                    </li>
                    <li class="divider"></li>

                    <li class="third">
                      <a href="//university.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega">F5 University</a>
                      <ul>
                        <li>
                          <p>Get up to speed with free self-paced courses</p>
                        </li>
                      </ul>
                      <a data-ng-href="https://devcentral.f5.com" class="a-mm-h internalLink" target="_blank"
                        data-link-type="Nav: Mega" href="https://devcentral.f5.com">DevCentral</a>
                      <ul>
                        <li>
                          <p>Join the community of 250,000+ technical peers</p>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="col-xs-12 stat">
          <div class="topLinks">
            <span class="glyphicon glyphicon-search upc-search" id="search-toggle" style="display: none;"></span>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /container-fluid -->
</div>
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BIG-IP - Venafi &#8212; F5 TLS Automation  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/f5-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/21fb8a09c3.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Contributions" href="../contributors.html" />
    <link rel="prev" title="BIG-IP - Terraform Provider" href="../terraform/bigipprovider/terraform.html" />





  </head><body>
  <div id="clouddocs-header"></div>

    <div id="dismiss">
      <button type="button" class="btn btn-info navbar-btn site-hidden">
        <i class="fa fa-align-justify"></i>
      </button>
    </div>
    <div id="sidebar" class="section-nav">

      <nav class="nav-sidebartoc">


         <h5>F5 TLS Automation  </h5>

<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <h5>Current Page</h5>
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">BIG-IP - Venafi</a></li>
</ul>

         </span>
        <hr>
        <h5>Site Contents</h5>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ansible/ansible.html">BIG-IP - Ansible Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../postman/postman.html">BIG-IP - Postman Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../letsencrypt/letsencrypt.html">BIG-IP - Letsencrypt with F5 Cloudservices DNS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terraform/bigipprovider/terraform.html">BIG-IP - Terraform Provider</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">BIG-IP - Venafi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors.html">Contributions</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


  <div class="main active" id="content">
    <article class="docs-container site-article-inner">
            <nav class="site-breadcrumb-nav site-nav">
          <ul class="site-breadcrumb-list">
            <li class="breadcrumb-item"><button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn site-hidden"><i class="fa fa-align-justify"></i></button>&#x20 <a href="/">F5 TLS Automation</a> &gt; <a href="../../index.html">F5 TLS Automation </a> &gt; BIG-IP - Venafi</li>
          </ul>
      </nav>



  <div class="section" id="big-ip-venafi">
<h1>BIG-IP - Venafi<a class="headerlink" href="#big-ip-venafi" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tested with Ansible 2.10 and Venafi Trust Protection Platform 20.2</p>
</div>
<p>This task is designed to pull Certificates/Keys from a Venafi Trust Protection Platform and publish them into a BIG-IP.</p>
<p>For Ansible to interact with Venafi Trust Protection Platform you will need to create an API Application Integration.</p>
<p>Under Configuration locate the correct area and create an Application ID for access:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This example Application ID has all Certificate rights, this may be more then desired</p>
</div>
<p><img alt="image1" src="../../_images/image12.png" /></p>
<p><img alt="image2" src="../../_images/image2.png" /></p>
<p>Steps of the task:</p>
<ul class="simple">
<li><p>Pull Certificates/Key from Venafi API</p></li>
<li><p>Store Certificates/Key in location</p></li>
<li><p>Upload Certificates/Key to BIG-IP</p></li>
<li><p>Create SSL Profile on BIG-IP</p></li>
<li><p>Delete Certificates/Key from playbook path</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This task will delete files, its designed this way, so Certificates/Keys are not left residually</p>
</div>
<p>Clone the repository to have the examples local, or copy the example code below. Task modification should not be necessary. However, you need to update the variables to your environment.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>vars</p></th>
<th class="head"><p>Variables Needed for Task</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bigips:</p></td>
<td><p>Array of BIG-IP Targets (IP or FQDN)</p></td>
</tr>
<tr class="row-odd"><td><p>provider:</p></td>
<td><p>BIG-IP information</p></td>
</tr>
<tr class="row-even"><td><p>server:</p></td>
<td><p>References <code class="docutils literal notranslate"><span class="pre">bigips</span></code> leave as default value <code class="docutils literal notranslate"><span class="pre">'{{</span> <span class="pre">item</span> <span class="pre">}}'</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>user:</p></td>
<td><p>BIG-IP Username</p></td>
</tr>
<tr class="row-even"><td><p>password:</p></td>
<td><p>BIG-IP Password</p></td>
</tr>
<tr class="row-odd"><td><p>validate_certs:</p></td>
<td><p>Validate BIG-IP Management Certificate</p></td>
</tr>
<tr class="row-even"><td><p>server_port:</p></td>
<td><p>BIG-IP Connectivity Port</p></td>
</tr>
<tr class="row-odd"><td><p>partition:</p></td>
<td><p>BIG-IP Partition for Objects</p></td>
</tr>
<tr class="row-even"><td><p>domain_name:</p></td>
<td><p>FQDN of Certificate Object</p></td>
</tr>
<tr class="row-odd"><td><p>state:</p></td>
<td><p>Object state <code class="docutils literal notranslate"><span class="pre">present</span></code> is create <code class="docutils literal notranslate"><span class="pre">absent</span></code> is delete</p></td>
</tr>
<tr class="row-even"><td><p>venafi:</p></td>
<td><p>URL for Venafi Trust Protection Platform (IP or FQDN)</p></td>
</tr>
<tr class="row-odd"><td><p>venafiuser:</p></td>
<td><p>Venafi Username</p></td>
</tr>
<tr class="row-even"><td><p>venafipassword:</p></td>
<td><p>Venafi Password</p></td>
</tr>
<tr class="row-odd"><td><p>venaficlientid:</p></td>
<td><p>API Application Integration Application ID</p></td>
</tr>
<tr class="row-even"><td><p>venafiscopeid:</p></td>
<td><p>Scope rights of API Application Integration object</p></td>
</tr>
<tr class="row-odd"><td><p>certificatename:</p></td>
<td><p>Name of Certificate to export from Venafi</p></td>
</tr>
<tr class="row-even"><td><p>keypassphrase:</p></td>
<td><p>Key Passphrase</p></td>
</tr>
</tbody>
</table>
<p>Run: <strong>ansible-playbook main.yml</strong></p>
<p>Task:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="c1">#    Created by - Jon Calalang</span>
<span class="c1">#    This task comes with no warranty or support</span>
<span class="c1">#</span>
<span class="c1">#    Modules used:</span>
<span class="c1">#</span>
<span class="c1">#    - uri</span>
<span class="c1">#    - set_fact</span>
<span class="c1">#    - bigip_profile_client_ssl</span>
<span class="c1">#    - bigip_ssl_key</span>
<span class="c1">#    - bigip_ssl_cert</span>
<span class="c1">#    - copy</span>
<span class="c1">#</span>
<span class="c1">#    Module Documentation: https://docs.ansible.com/ansible/2.9/modules/list_of_all_modules.html</span>
<span class="c1">#</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Export Certificate and Key from Venafi and create BIG-IP Client SSL Profile</span>
  <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
  <span class="nt">connection</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local</span>

  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">venafi</span><span class="p">:</span> <span class="s">&#39;venafi.fqdn.com&#39;</span>
    <span class="nt">venafiuser</span><span class="p">:</span> <span class="s">&#39;Admin&#39;</span>
    <span class="nt">venafipassword</span><span class="p">:</span> <span class="s">&#39;Password&#39;</span>
    <span class="nt">venaficlientid</span><span class="p">:</span> <span class="s">&#39;certmanager_key&#39;</span>
    <span class="nt">venafiscopeid</span><span class="p">:</span> <span class="s">&#39;Certificate:manage&#39;</span>
    <span class="nt">certificatename</span><span class="p">:</span> <span class="s">&#39;example.cert.name&#39;</span>
    <span class="nt">keypassphrase</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
    <span class="nt">bigips</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">bigip1.fqdn.com</span><span class="p p-Indicator">,</span><span class="nv">bigip2.fqdn.com</span><span class="p p-Indicator">]</span>
    <span class="nt">provider</span><span class="p">:</span>
      <span class="nt">server</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">user</span><span class="p">:</span> <span class="s">&#39;admin&#39;</span>
      <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;password&#39;</span>
      <span class="nt">validate_certs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
      <span class="nt">server_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
    <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;Common&#39;</span>
    <span class="nt">domainname</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">certificatename</span><span class="nv"> </span><span class="s">}}&#39;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;present&#39;</span>

  <span class="nt">tasks</span><span class="p">:</span>

<span class="c1"># Venafi Interaction</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get Venafi Authentication Token from {{ venafi }}</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">uri</span><span class="p">:</span>
        <span class="nt">body</span><span class="p">:</span> <span class="s">&#39;{&quot;username&quot;:&quot;{{</span><span class="nv"> </span><span class="s">venafiuser</span><span class="nv"> </span><span class="s">}}&quot;,&quot;password&quot;:&quot;{{</span><span class="nv"> </span><span class="s">venafipassword</span><span class="nv"> </span><span class="s">}}&quot;,&quot;client_id&quot;:&quot;{{</span><span class="nv"> </span><span class="s">venaficlientid</span><span class="nv"> </span><span class="s">}}&quot;,&quot;scope&quot;:&quot;{{</span><span class="nv"> </span><span class="s">venafiscopeid</span><span class="nv"> </span><span class="s">}}&quot;}&#39;</span>
        <span class="nt">body_format</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="nt">method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
        <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;https://{{</span><span class="nv"> </span><span class="s">venafi</span><span class="nv"> </span><span class="s">}}/vedauth/authorize/&quot;</span>
        <span class="nt">status_code</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">venafi_auth_response</span>
      <span class="nt">retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
      <span class="nt">until</span><span class="p">:</span> <span class="s">&quot;(venafi_auth_response.status</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">200)&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Assign Auth Token to Variable</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">venafi_auth_response</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">venafi_auth_response.json.access_token</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get Certificate DN location from {{ venafi }}</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">uri</span><span class="p">:</span>
        <span class="nt">method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GET</span>
        <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;https://{{</span><span class="nv"> </span><span class="s">venafi</span><span class="nv"> </span><span class="s">}}/vedsdk/certificates?name={{</span><span class="nv"> </span><span class="s">certificatename</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">status_code</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
        <span class="nt">headers</span><span class="p">:</span>
          <span class="nt">Content-Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/json</span>
          <span class="nt">Authorization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Bearer {{ venafi_auth_response }}</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificate_dn_location</span>
      <span class="nt">retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
      <span class="nt">until</span><span class="p">:</span> <span class="s">&quot;(certificate_dn_location.status</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">200)&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get DN of {{ certificatename }}</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">certificate_dn</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">certificate_dn_location.json.Certificates[0].DN</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get {{ certificatename }} from {{ venafi }}</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">uri</span><span class="p">:</span>
        <span class="nt">body</span><span class="p">:</span> <span class="s">&#39;{</span><span class="nv">  </span><span class="s">&quot;CertificateDN&quot;:</span><span class="nv"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">certificate_dn</span><span class="nv"> </span><span class="s">}}&quot;,&quot;Format&quot;:</span><span class="nv"> </span><span class="s">&quot;base64&quot;,&quot;Password&quot;:</span><span class="nv"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">keypassphrase</span><span class="nv"> </span><span class="s">}}&quot;,&quot;IncludePrivateKey&quot;:</span><span class="nv"> </span><span class="s">true,&quot;IncludeChain&quot;:</span><span class="nv"> </span><span class="s">true,&quot;FriendlyName&quot;:</span><span class="nv"> </span><span class="s">&quot;string&quot;,&quot;RootFirstOrder&quot;:</span><span class="nv"> </span><span class="s">false,&quot;KeystorePassword&quot;:</span><span class="nv"> </span><span class="s">&quot;string&quot;}&#39;</span>
        <span class="nt">body_format</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
        <span class="nt">method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">POST</span>
        <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;https://{{</span><span class="nv"> </span><span class="s">venafi</span><span class="nv"> </span><span class="s">}}/vedsdk/certificates/Retrieve&quot;</span>
        <span class="nt">status_code</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
        <span class="nt">headers</span><span class="p">:</span>
          <span class="nt">Content-Type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">application/json</span>
          <span class="nt">Authorization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Bearer {{ venafi_auth_response }}</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">certificate_data</span>
      <span class="nt">retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Hold {{ certificatename }} data</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">certificate_b64encoded</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">certificate_data.json.CertificateData</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">copy</span><span class="p">:</span>
        <span class="nt">content</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">certificate_b64encoded</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">b64decode</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">certificatename</span><span class="nv"> </span><span class="s">}}.key&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">copy</span><span class="p">:</span>
        <span class="nt">content</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">certificate_b64encoded</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">b64decode</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">certificatename</span><span class="nv"> </span><span class="s">}}.crt&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Revoke auth token from {{ venafi }}</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">uri</span><span class="p">:</span>
        <span class="nt">method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get</span>
        <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;https://{{</span><span class="nv"> </span><span class="s">venafi</span><span class="nv"> </span><span class="s">}}/vedauth/revoke/token&quot;</span>
        <span class="nt">status_code</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="nt">validate_certs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
        <span class="nt">headers</span><span class="p">:</span>
          <span class="nt">Authorization</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Bearer {{ venafi_auth_response }}</span>
      <span class="nt">retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

<span class="c1"># Delete Objects</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Wait a maximum of 300 seconds for BIG-IP to be ready to take configuration</span>
      <span class="nt">bigip_wait</span><span class="p">:</span>
        <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;absent&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Delete a Client SSL profile</span>
      <span class="nt">bigip_profile_client_ssl</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;tls_profile_{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;absent&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Delete SSL Key</span>
      <span class="nt">bigip_ssl_key</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_bundle&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;absent&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Delete SSL Certificate</span>
      <span class="nt">bigip_ssl_certificate</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_bundle&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;absent&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Save the running configuration of the BIG-IP</span>
      <span class="nt">bigip_config</span><span class="p">:</span>
        <span class="nt">save</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;absent&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># Create Objects</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Wait a maximum of 300 seconds for BIG-IP to be ready to take configuration</span>
      <span class="nt">bigip_wait</span><span class="p">:</span>
        <span class="nt">timeout</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Import SSL Key</span>
      <span class="nt">bigip_ssl_key</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_bundle&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">content</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}.key&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Import SSL Certificate</span>
      <span class="nt">bigip_ssl_certificate</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_bundle&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">content</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;file&#39;,</span><span class="nv"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}.crt&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create a Client SSL profile with a cert/chain/key</span>
      <span class="nt">bigip_profile_client_ssl</span><span class="p">:</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">partition</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;tls_profile_{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">}}&#39;</span>
        <span class="nt">cert_key_chain</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">cert</span><span class="p">:</span> <span class="s">&#39;/{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_bundle&#39;</span>
            <span class="nt">key</span><span class="p">:</span> <span class="s">&#39;/{{</span><span class="nv"> </span><span class="s">partition</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_bundle&#39;</span>
            <span class="nt">passphrase</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">keypassphrase</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Save the running configuration of the BIG-IP</span>
      <span class="nt">bigip_config</span><span class="p">:</span>
        <span class="nt">save</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
        <span class="nt">provider</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">provider</span><span class="nv"> </span><span class="s">}}&#39;</span>
      <span class="nt">delegate_to</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>
      <span class="nt">with_items</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">bigips</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># Remove Local Files</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove Local Key</span>
      <span class="nt">ansible.builtin.file</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}.key&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove Local Certificate</span>
      <span class="nt">ansible.builtin.file</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}.crt&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>

    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove Local CA Chain</span>
      <span class="nt">ansible.builtin.file</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">playbook_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">domainname</span><span class="nv"> </span><span class="s">}}_cachain.crt&#39;</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">state == &quot;present&quot;</span>
</pre></div>
</div>
</div>



     <div class="row next-prev-btn-row">
       <div class="col-lg-12">

        <a href="../terraform/bigipprovider/terraform.html" title="BIG-IP - Terraform Provider" accesskey="p" class="btn btn-primary pull-left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>


          <a href="../contributors.html" title="Contributions" accesskey="n" class="btn btn-primary pull-right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>

     </div>
     </div>


    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/bootstrap.min.js"></script>
  <script src="../../_static/js/clouddocs.js"></script>
  </body>
</html>
